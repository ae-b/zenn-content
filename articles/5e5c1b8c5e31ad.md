---
title: "Ruby on Rails 1ãƒ¶æœˆãƒ¡ãƒ¢ - DBå‘¨ã‚Š"
emoji: "ğŸ“š"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Rails"]
published: false
---
# ã“ã‚Œã¯ãªã«

Ruby on Railsã‚’ä½¿ç”¨ã™ã‚‹ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã§åƒãè‡ªåˆ†ãŒã€è‡ªåˆ†ã®ãŸã‚ã«æ®‹ã™ãƒ¡ãƒ¢ã€‚
1ãƒ¶æœˆãã®1ã€DBå‘¨ã‚Šã®æ§‹é€ ã«ã¤ã„ã¦ã€‚

# ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’åˆã‚ã¦ä½œæˆã™ã‚‹=modelã‚’ä½œæˆã™ã‚‹
- modelã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æƒ…å ±ã‚’æ ¼ç´ã—ã¦ã„ã‚‹
- ãƒ¢ãƒ‡ãƒ«å˜ä½“ã®ã‚³ãƒãƒ³ãƒ‰
```
rails generate model ãƒ¢ãƒ‡ãƒ«å
```
- ãƒ†ãƒ¼ãƒ–ãƒ«ã‚‚ä½œæˆã™ã‚‹ã‚³ãƒãƒ³ãƒ‰
```
rails generate model ãƒ¢ãƒ‡ãƒ«å ã‚«ãƒ©ãƒ å:å‹:(unique|index)
```
- ãƒ¢ãƒ‡ãƒ«åã¯åè©ã€ã‚‚ã—ãã¯å½¢å®¹è©ï¼‹åè©ã«ã™ã‚‹ã“ã¨
- ãƒ‘ã‚¹ã‚«ãƒ«ã‚±ãƒ¼ã‚¹ã«ã™ã‚‹ã“ã¨
- å˜æ•°å½¢ã«ã™ã‚‹ã“ã¨

- ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä¿®æ­£ã™ã‚‹å ´åˆ
```
rails generate migration å¯¾è±¡å‹•ä½œToã‚¯ãƒ©ã‚¹å price:integer
```
- å¯¾è±¡å‹•ä½œToã‚¯ãƒ©ã‚¹åã®åä»˜ã‘æ–¹ã®[å‚è€ƒ](https://railsguides.jp/active_record_migrations.html)
- ã“ã“ã§ã®åå‰ã«å¤§ããªæ„å‘³ã¯æŒãŸãªã„

**å®Ÿè¡Œã™ã‚‹**

- DB/migrate/æ—¥æ™‚_ã»ã«ã‚ƒã‚‰ã‚‰.rbãŒä½œæˆã•ã‚Œã‚‹ã®ã§ç·¨é›†ã™ã‚‹
    - `null: false` not nullåˆ¶ç´„
    - `default: false` booleanå‹ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
    - å¤–éƒ¨ã‚­ãƒ¼ã®è¨­å®š
        - `t.references :user, foreign_key: true`
        - ä¸Šè¨˜ã®`user`ã¯userãƒ†ãƒ¼ãƒ–ãƒ«ã®`user_id`ã®ã“ã¨ã€‚è‡ªå‹•çš„ã«idã§èªè­˜ã™ã‚‹ã€‚
    - `unique: true` idä»¥å¤–ã®ä¸€æ„åˆ¶ç´„
    - `t.timestamps` created_atã¨updated_at
    - `add_index :è¿½åŠ ã—ãŸã„ãƒ†ãƒ¼ãƒ–ãƒ«å, ã‚«ãƒ©ãƒ å, å¿…è¦ãªã‚‰ã‚ªãƒ—ã‚·ãƒ§ãƒ³å` index
        - è¨­å®šå¯èƒ½ãªã‚ªãƒ—ã‚·ãƒ§ãƒ³
            - `:name` ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®åå‰
            - `:if_not_exists` ã‚«ãƒ©ãƒ ãŒã™ã§ã«å­˜åœ¨ã—ã¦ã„ã‚‹å ´åˆã¯å†è¿½åŠ ã‚’è¡Œã‚ãªã„ã‚ˆã†ã«æŒ‡å®š
            - `:unique` trueã‚’æŒ‡å®šã™ã‚‹ã¨ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
            - `:length` ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã«å«ã¾ã‚Œã‚‹ã‚«ãƒ©ãƒ ã®é•·ã•

- DB/migrate/ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤ã™ã‚‹å ´åˆ
```
rails destroy migration æ—¥æ™‚_ã»ã«ã‚ƒã‚‰ã‚‰.rbã®ã»ã«ã‚ƒã‚‰ã‚‰ã®éƒ¨åˆ†
```

**migrate**

- migrateã¯Active Recordã®æ©Ÿèƒ½ã§ã‚ã‚‹
```
rails db:migrate
```
- app/models/ãƒ¢ãƒ‡ãƒ«å.rbãŒä½œæˆã•ã‚Œã‚‹
    - [annotateã®gem](https://github.com/ctran/annotate_models/blob/develop/README.md)ã‚’ã¤ã‘ã‚‹ã¨ã‚ˆã‚Šåˆ†ã‹ã‚Šã‚„ã™ããªã‚‹

- é–“é•ãˆãŸå ´åˆ
```
rails db:rollback
```

- schema.rbãŒä¿®æ­£ã•ã‚Œã‚‹
    - æœ€æ–°ã®DBã®çŠ¶æ…‹ãŒåæ˜ ã•ã‚Œã¦ãŠã‚Šã€DBã®æ§‹é€ ã‚’ç¤ºã™ãƒ‡ãƒ¼ã‚¿ã€‚DBã®å®Œæˆå½¢

## modelã‚¯ãƒ©ã‚¹ã«ãŠã‘ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ä½¿ç”¨
- ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’è¿½åŠ ã™ã‚‹äº‹ã§æ§˜ã€…ãªæ©Ÿèƒ½ã‚’ä½¿ç”¨ã§ãã‚‹
    - 

# ãƒ‡ãƒ¼ã‚¿ã‚’æ“ä½œã—ã¦ã¿ã‚‹

ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¤ã„ã¦ã‚ã‹ã‚Šã‚„ã™ã„â†“
https://pikawaka.com/rails/migration

# å‚ç…§
- [Railsã«ãŠã‘ã‚‹å‘½åè¦å‰‡](https://qiita.com/gakkie/items/3afcd505c786364aa5fa)
- [ãƒ¢ãƒ‡ãƒ«ã‚„ãƒ¡ã‚½ãƒƒãƒ‰ã«åå‰ã‚’ä»˜ã‘ã‚‹ã¨ãã¯è‹±èªã®å“è©ã«æ°—ã‚’ã¤ã‘ã‚ˆã†](https://qiita.com/jnchito/items/459d58ba652bf4763820)
- [rails generate migrationã‚³ãƒãƒ³ãƒ‰ã¾ã¨ã‚](https://qiita.com/zaru/items/cde2c46b6126867a1a64)
- [migrationãƒ•ã‚¡ã‚¤ãƒ«ã®add_indexã¯ä½•ãªã®ã‹](https://qiita.com/mmaumtjgj/items/9f4fca618d2f395f985e)
- [Booleanå‹ã®ã‚«ãƒ©ãƒ ã‚’è¿½åŠ ã™ã‚‹ã¨ãã¯å¿…ãšãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®šã—ã‚ˆã†](https://qiita.com/jnchito/items/a342b64cd998e5c4ef3d)
- [Active Record ã®åŸºç¤](https://railsguides.jp/active_record_basics.html)